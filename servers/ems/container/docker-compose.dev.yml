services:
  ems_server:
    container_name: ems_server_dev
    image: ems-server:latest
    build:
      context: ../../../
      dockerfile: servers/ems/container/Dockerfile
      args:
        VERSION: ${VERSION:-dev}
        ENVIRONMENT: ${ENVIRONMENT:-development}
    expose:
      - "${SERVER_PORT}"
    environment:
      - ENV=${ENVIRONMENT:-development}
    env_file:
      - .env
    volumes:
      - ${UPLOADS_HOST_PATH:-../../.dev-data/uploads/ems}:${UPLOADS_CONTAINER_PATH:-/app/uploads}
      - ${LOGS_HOST_PATH:-../../.dev-data/logs/ems}:${LOGS_CONTAINER_PATH:-/app/logs}
    restart: unless-stopped
    networks:
      - ems_system_net
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.ems-api-dev.rule=Host(`api.ems.local`)"
      - "traefik.http.routers.ems-api-dev.entrypoints=websecure"
      - "traefik.http.routers.ems-api-dev.tls=true"
      - "traefik.http.services.ems-api-dev.loadbalancer.server.port=${SERVER_PORT}"
      - "com.ems.service=ems-server"
      - "com.ems.environment=development"

networks:
  ems_system_net:
    external: true
